box: wercker/nodejs
# Build definition
build:
  # The steps that will be executed on build
  steps:
    # A step that executes `npm install` command
    - npm-install
    # A step that executes `npm test` command
    - npm-test

    # A custom script step, name value is used in the UI
    # and the code value contains the command that get executed
    - script:
        name: echo nodejs information
        code: |
          echo "node version $(node -v) running"
          echo "npm version $(npm -v) running"

deploy:
  steps:
  - add-to-known_hosts:
        hostname: 107.170.140.133
   - mktemp:
      envvar: PRIVATEKEY_PATH
   - create-file:
      name: write key
      filename: $PRIVATEKEY_PATH
      content: $VDOT_PRIVATE
      overwrite: true
      hide-from-log: true
   - script:
      name: transfer application
      code: |
        pwd
        ls -la
        scp -i $PRIVATEKEY_PATH -o StrictHostKeyChecking=no -o UserKnownHostsFile=no digitalocean-test root@107.170.140.133:/opt/vdot
   - grunt:
      tasks: default
